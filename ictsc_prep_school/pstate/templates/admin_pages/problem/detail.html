{% extends 'adminlte/base.html' %}

{% block title %}My App{% endblock %}
{% block content %}
{% load static %}
<script src="{% static "ace/src/ace.js" %}" type="text/javascript" charset="utf-8"></script>
<script src="{% static "ace/src/cobalt.js" %}" type="text/javascript" charset="utf-8"></script>
<h1>{{ problem.display_name }}</h1>
<div align="right">
    <button class="btn btn-info" onClick="location.href=''">Preview</button>
    <button class="btn btn-info" onClick="location.href='{% url 'pstate-manage:problems-problemenvironment-create' pk=problem.id %}'">Test run</button>
    <button class="btn btn-info" onClick="location.href=''">Create problem environment</button>
</div>
<div align="right">
    <button class="btn btn-danger" onClick="location.href='{% url 'pstate-manage:problem-delete' pk=problem.id %}'">Delete</button>
</div>
<div class="problem-body">
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_1" data-toggle="tab">Problem sentence</a></li>
            <!--    TODO    :   添付ファイルの保存先が確定したら、有効化する  -->
            <!--    <li><a href="#tab_2" data-toggle="tab">Problem attachments</a></li>  -->
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab_1">
                <div align="right">
                    <button class="btn btn-info" onClick="javascript:window.open('{% url 'pstate-manage:problem-body-edit' pk=problem.id %}', 'yourWindowName', 'width=1200,height=1000');" >Edit</button>
                </div>
                {{ problem.description|linebreaks }}
            </div>
            <div class="tab-pane" id="tab_2">
                <div align="right">
                    <button class="btn btn-info" onClick="location.href='{% url 'pstate-manage:problem-edit' pk=problem.id %}'">Edit</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    <h2>Terraform</h2>
    {% if problem.terraform_file_id == None %}
    <div align="right">
        <button class="btn btn-primary" onClick="javascript:window.open('{% url 'pstate-manage:terraformfile-create' pk=problem.id %}', 'yourWindowName', 'width=1200,height=1000');" >Add</button>
    </div>
    {% else %}
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_1t" data-toggle="tab">Terraform - TerraformFile</a></li>
            <li><a href="#tab_2t" data-toggle="tab">Terraform - Provider</a></li>
            <li><a href="#tab_3t" data-toggle="tab">Terraform - ShellScript</a></li>
            <li><a href="#tab_4t" data-toggle="tab">Terraform - Variables</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab_1t">
                <div align="right">
                    <button class="btn btn-info" onClick="javascript:window.open('{% url 'pstate-manage:terraformfile-edit' pk=problem.terraform_file_id.id %}', 'yourWindowName', 'width=1200,height=1000');" >Edit</button>
                </div>
                <h3>Terraform File</h3>
                <div>
                    <table class="table table-striped table-bordered">
                        <tbody>
                            <tr><th>Name</th><td>{{ problem.terraform_file_id.name }}</td></tr>
                            <tr><th>FileName</th><td>{{ problem.terraform_file_id.file_name }}</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="editor-div" style="height: 500px; width: 100%;"></div>
                <textarea id="text" name="text">{{ problem.terraform_file_id.body }}</textarea>
            </div>
            <div class="tab-pane" id="tab_2t">
                <h3>Provider</h3>
                <table class="table table-striped table-bordered">
                    <tbody>
                        <tr><th>ID</th><td>{{ problem.terraform_file_id.provider.id }}</td></tr>
                        <tr><th>Name</th><td>{{ problem.terraform_file_id.provider.name }}</td></tr>
                        <tr><th>ProviderName</th><td>{{ problem.terraform_file_id.provider.provider_name }}</td></tr>
                    </tbody>
                </table>
                <h3>Attributes</h3>
                <table class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>Key</th>
                        <th>Value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for attribute in problem.terraform_file_id.provider.attribute.all %}
                    <tr>
                        <td>
                            {{ attribute.key }}
                        </td>
                        <td>
                            {{ attribute.value }}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="tab-pane" id="tab_3t">
                <div align="right">
                    <button class="btn btn-primary" onClick="javascript:window.open('{% url 'pstate-manage:shell_script-create' pk=problem.id %}', 'yourWindowName', 'width=1200,height=1000');" >Add</button>
                </div>
                <h3>ShellScript</h3>
                {% for shell_script in problem.terraform_file_id.shell_script.all %}
                <h4>{{ shell_script.name }}</h4>
                <div align="right">
                    <button class="btn btn-info" onClick="javascript:window.open('{% url 'pstate-manage:shell_script-edit' pk=shell_script.id %}', 'yourWindowName', 'width=1200,height=1000');" >Edit</button>
                    <button class="btn btn-danger" onClick="javascript:window.open('{% url 'pstate-manage:shell_script-delete' pk=shell_script.id %}', 'yourWindowName', 'width=1200,height=1000');" >Edit</button>
                </div>
                <table class="table table-striped table-bordered">
                    <tbody>
                        <tr><th>Name</th><td>{{ shell_script.name }}</td></tr>
                        <tr><th>FileName</th><td>{{ shell_script.file_name }}</td></tr>
                    </tbody>
                </table>
                <div id="editor-div-{{ forloop.counter }}" style="height: 500px; width: 100%;"></div>
                <textarea id="text-{{ forloop.counter }}" name="text-{{ forloop.counter }}">{{ shell_script.body }}</textarea>

                <script type="text/javascript">
                    document.getElementById( 'text-{{ forloop.counter }}' ).style.display = 'none';
                    document.getElementById( 'editor-div-{{ forloop.counter }}' ).innerHTML = document.getElementById( 'text-{{ forloop.counter }}' ).value;
                    // or editor.setValue( "the new text here" );
                    var editor = ace.edit( 'editor-div-{{ forloop.counter }}' );
                    editor.setTheme( 'ace/theme/cobalt' );
                    editor.getSession().setMode( 'ace/mode/perl' );
                    editor.setReadOnly(true);
                    document.getElementById( 'editor-div-{{ forloop.counter }}' ).style.fontSize = '14';
                    editor.getSession().on('change', function(){
                        var textcode = editor.getSession().getValue();
                        document.getElementById( 'text-{{ forloop.counter }}' ).value = textcode;
                    });
                </script>
                {% endfor %}
            </div>
            <div class="tab-pane" id="tab_4t">
                <div align="right">
                    <button class="btn btn-info" onClick="location.href='{% url 'pstate-manage:problem-edit' pk=problem.id %}'">Edit</button>
                </div>
                <h3>Variables</h3>
                <table class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>Key</th>
                        <th>Value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for variable in problem.terraform_file_id.variables.all %}
                    <tr>
                        <td>
                            {{ variable.key }}
                        </td>
                        <td>
                            {{ variable.value }}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
<script type="text/javascript">
    document.getElementById( 'text' ).style.display = 'none';
    document.getElementById( 'editor-div' ).innerHTML = document.getElementById( 'text' ).value;
    // or editor.setValue( "the new text here" );
    var editor = ace.edit( 'editor-div' );
    editor.setTheme( 'ace/theme/cobalt' );
    editor.getSession().setMode( 'ace/mode/perl' );
    editor.setReadOnly(true);
    document.getElementById( 'editor-div' ).style.fontSize = '14';
    editor.getSession().on('change', function(){
        var textcode = editor.getSession().getValue();
        document.getElementById( 'text' ).value = textcode;
    });
</script>
{% endblock %}