問題の仕様
============================

問題環境全体構成
----------------------------

VNCサーバ(踏み台サーバ)とは、参加者が問題環境にアクセスするためのサーバです。

このサーバには参加者からVNCで接続してもらいます、VNCで接続するとディスクトップ環境が表示され、参加者はその環境からターミナルを開くなりして、問題に挑戦します。

問題環境がグローバルではなくローカル環境に閉じている理由は、外部からの攻撃等によって問題を解くにあたって支障をきたす恐れがあるためです。(過去の予選で一部チームがDoSを受け、問題を満足に解くことができなかったことがあったため)

以下の図、問題環境全体構成にあるリソースはすべて、問題とチームごとに独立しており、環境は問題環境の作成(terraform)によって全てが作成され、問題環境が不要になった時点で全てが破棄される(使い捨て)


::

      ーーーーーーーーーーー
     ｜　　　　　　　　　　｜
     ｜　　共有セグメント　｜
     ｜　　　　　　　　　　｜
      ーーーーーーーーーーー
               ｜
               ｜
               ｜
               ｜
      ーーーーーーーーーーー
     ｜　　　　eth0　　 　｜
     ｜ グローバルIP　　　｜
     ｜　　　　　　　　　　｜
     ｜　　VNCサーバ     ｜
     ｜　　　　　　　　　　｜
     ｜　　　　eth1　　 　｜
     ｜192.168.0.254/24 |
     ｜　　　　　　　　　　｜
      ーーーーーーーーーーー
               ｜
               ｜
               ｜ーーーーー↓↓↓↓ここから下が問題で実際に使用するサーバ
               ｜
      ーーーーーーーーーーー
     ｜　　　　　　　　　　｜
     ｜　ローカルスイッチ　｜
     ｜　　　　　　　　　　｜
      ーーーーーーーーーーー
               ｜
               ｜
               ｜
               ｜
      ーーーーーーーーーーー
     ｜　　　　　　　　　　｜
     ｜　　　　　　　　　　｜
     ｜　　問題サーバ     ｜　　．．．．．．．．．．(問題で必要な台数分)
     ｜　　　　　　　　　　｜
     ｜　　　　　　　　　　｜
     ｜　　　　　　　　　　｜
      ーーーーーーーーーーー　　

それぞれの仕様
----------------------------

共有セグメント
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

サーバがインターネットと疎通するための接続点
100Mbpsの共有回線(帯域保証なし)
VNCサーバのeth0はここに接続される

技術仕様などは以下を参照

https://manual.sakura.ad.jp/cloud/support/technical/network.html#support-network-01

https://manual.sakura.ad.jp/cloud/support/technical/network.html#support-network-02

VNCサーバ(踏み台)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
参加者が問題環境にアクセスするために踏み台として使うサーバ

インタフェースは2つあり、eth0がグローバルIPを持つ。eth1はローカルIPを持ち、問題環境へアクセスできる。

参加者側のPCからは、VNCクライアントでこのサーバ上で動作しているVNCサーバにアクセスしてもらい、すでにセットアップされているディスクトップ環境からターミナルなどを開き問題に挑戦してもらう。

VNCサーバの作成ですが、ディスクトップ環境のインストール処理に時間がかかるため、あらかじめディスクトップ環境が入った状態のアーカイブイメージを作成し
問題環境作成の度に、アーカイブイメージからVNCサーバのインスタンスを作成し、sshホスト鍵の再生成 / rootユーザパスワードの変更 / VNCユーザ名・パスワードの変更 などの処理を行う。

なお、VNCユーザ名・パスワードはterraform applyコマンド実行時に変数として引き渡される値を用いる。

VNCの他にも、問題サーバからインターネットへ通信する際のGWとしての役割も持つ。

採点者がログインできるように、採点用のSSH公開鍵を設置する。

採点用のサーバに採点用のSSH秘密鍵を入れて、採点用のサーバに採点者の公開鍵を入れる。そして採点する。

ローカルスイッチ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

問題環境への接続点。

このスイッチ配下に問題サーバ群がぶら下がる。

問題サーバ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

問題サーバです。

問題サーバの構築は、外部から問題サーバにアクセスできないため(terraformのremote-execがりようできない)

Terraform for さくらのクラウドのスタートアップスクリプト(sakuracloud_note)の機能を用いて、構築を行う。

参考資料

https://sacloud.github.io/terraform-provider-sakuracloud/configuration/resources/data/note/

問題の要求仕様
----------------------------

1.問題サーバからインターネット側への通信を行う場合には、192.168.0.254/24をGWに設定してください。

2.terraform実行時にスタートアップスクリプトを実行する場合、VNCサーバが立ち上がるまで問題サーバからインターネット側への通信ができません。

3.さくらのクラウドのコントロールパネルのコンソールを使う問題は出題できません。

4.あらかじめ問題サーバのディスクイメージを作成し、terraform実行時には、アーカイブIDを指定して問題サーバを作成することをお勧めします。